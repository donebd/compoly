language: java
install: true

os: linux
dist: trusty
jdk: oraclejdk15

script:
  - chmod 777 ./gradlew
  - ./gradlew build --info

before_install:
  - sudo apt-get install openssh-client
  - openssl aes-256-cbc -K $encrypted_b4f3819162af_key -iv $encrypted_b4f3819162af_iv
    -in travis_key.enc -out ~/travis_key -d

deploy:
  - provider: script
    script: deploy.sh
    skip_cleanup: true
    on:
      branch: master

after_success:
  - eval "$(ssh-agent -s)"
  - chmod 600 ~/travis_key
  - echo -e "Host 130.61.203.95\n\tStrictHostKeyChecking no\n" >> ~/.ssh/config
  - ssh-add ~/travis_key
  - sudo scp -o StrictHostKeyChecking=no -i ~/travis_key ./build/libs/vkBot.jar ubuntu@${SERVER_IP}:/home/ubuntu/vkBot/lib/vkBot.jar
  - sudo ssh -o StrictHostKeyChecking=no -i ~/travis_key ubuntu@${SERVER_IP} sh /home/ubuntu/restartbot.sh